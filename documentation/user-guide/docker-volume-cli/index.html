<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="containers@vmware.com">
  
  <title>Create & manage docker volumes - vSphere Docker Volume Service</title>
  

  <link rel="shortcut icon" href="../../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Create & manage docker volumes";
    var mkdocs_page_input_path = "user-guide/docker-volume-cli.md";
    var mkdocs_page_url = "/user-guide/docker-volume-cli/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-81413942-1', 'https://vmware.github.io/docker-volume-vsphere/');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> vSphere Docker Volume Service</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Setup</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../install/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../docker-plugin-drivers/">Advanced Configuration</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>User Guide</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Create & manage docker volumes</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#using-the-service-in-docker">Using the Service in Docker</a></li>
                
                    <li><a class="toctree-l4" href="#docker-volume-create-options">Docker volume create options</a></li>
                
                    <li><a class="toctree-l4" href="#docker-volume-list">Docker volume list</a></li>
                
                    <li><a class="toctree-l4" href="#docker-volume-inspect">Docker volume inspect</a></li>
                
                    <li><a class="toctree-l4" href="#docker-compose">Docker Compose</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../datastores/">Multiple Datastores</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../admin-cli/">Admin CLI</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../vsphere-overview/">Volume Layout on backend</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Advanced Features</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/tenancy/">Tenancy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/vsan-policy/">Policy Management</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/vcenter/">Integration with vCenter</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../faq/">FAQ</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Blog</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../blog/2016-9-28/">Release announcement and updates</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../blog/2016-10-28/">0.8.1 Release (Tenancy) and stateful containers meetup</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">vSphere Docker Volume Service</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Create & manage docker volumes</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="using-the-service-in-docker">Using the Service in Docker<a class="headerlink" href="#using-the-service-in-docker" title="Permanent link">&para;</a></h1>
<p>The Docker volume commands are supported for both the vSphere and Photon platforms with minor differences in capabilities. Features that are specific to either of the platforms are mentioned explicitly below.
<script type="text/javascript" src="https://asciinema.org/a/80417.js" id="asciicast-80417" async></script></p>
<h2 id="docker-volume-create-options">Docker volume create options<a class="headerlink" href="#docker-volume-create-options" title="Permanent link">&para;</a></h2>
<h3 id="size">size<a class="headerlink" href="#size" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=&lt;vsphere/photon&gt; --name=MyVolume -o size=10gb
</code></pre>

<p>The volume units can be <code>mb, gb and tb</code></p>
<p>The default volume size is 100mb</p>
<h3 id="vsan-policy-name-vsphere-only">vsan-policy-name (vSphere only)<a class="headerlink" href="#vsan-policy-name-vsphere-only" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o vsan-policy-name=allflash
</code></pre>

<p>Policy needs to be created via the vmdkops-admin-cli. Once policy is created, it can be addressed during create by passing the <code>-o vsan-policy-name</code> flag.</p>
<h3 id="diskformat-vsphere-only">diskformat (vSphere only)<a class="headerlink" href="#diskformat-vsphere-only" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o diskformat=zeroedthick
docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o diskformat=thin
docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o diskformat=eagerzeroedthick
</code></pre>

<p>Docker volumes are backed by VMDKs. VMDKs support multiple <a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242">types</a></p>
<p>Currently the following are supported</p>
<ol>
<li>Thick Provision Lazy Zeroed (<a href="../(https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242)">zeroedthick</a>)</li>
<li>Thin Provision (<a href="../(https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242)">thin</a>)</li>
<li>Thick Provision Eager Zeroed (<a href="../(https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1022242)">eagerzeroedthick</a>)</li>
</ol>
<h3 id="attach_as-vsphere-only">attach_as (vSphere only)<a class="headerlink" href="#attach_as-vsphere-only" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o attach_as=independent_persistent
docker volume create --driver=vsphere --name=MyVolume -o size=10gb -o attach_as=persistent
</code></pre>

<p>Docker volumes are backed by VMDKs. VMDKs are attached to the VM in which Docker is requesting for a volume during Docker run. VMDKs can be attached in <a href="http://cormachogan.com/2013/04/16/what-are-dependent-independent-disks-persistent-and-non-persisent-modes/">different modes.</a></p>
<p>Currently the following are supported</p>
<ol>
<li><a href="http://cormachogan.com/2013/04/16/what-are-dependent-independent-disks-persistent-and-non-persisent-modes/">persistent</a>: If the VMDK is attached as persistent it will be part of a VM snapshot. If a VM snapshot has been taken while the Docker volume is attached to a VM, the Docker volume then continues to be attached to the VM that was snapshotted.</li>
<li><a href="http://cormachogan.com/2013/04/16/what-are-dependent-independent-disks-persistent-and-non-persisent-modes/">independent_persistent</a>: If the VMDK is attached as independent_persistent it will not be part of a VM snapshot. The Docker volume can be attached to any VM that can access the datastore independent of snapshots.</li>
</ol>
<h3 id="access-vsphere-only">access (vSphere only)<a class="headerlink" href="#access-vsphere-only" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=vsphere --name=MyVolume -o access=read-only -o diskformat=thin
docker volume create --driver=vsphere --name=MyVolume -o access=read-write -o diskformat=thin (default)
</code></pre>

<p>The access mode determines if the volume is modifiable by containers in a VM. The access mode allows to first create a volume with write access and initialize it with binary images, libraries (for exmple), and subsequently change the access to &ldquo;read-only&rdquo; (via the admin CLI). Thereby, creating content sharable by all containers in a VM.</p>
<h3 id="fstype">fstype<a class="headerlink" href="#fstype" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=&lt;vsphere/photon&gt; --name=MyVolume -o size=10gb -o fstype=xfs
docker volume create --driver=&lt;vsphere/photon&gt; --name=MyVolume -o size=10gb -o fstype=ext4 (default)
</code></pre>

<p>Specifies which filesystem will be created on the new volume. vSphere Docker Volume Service will search for a existing /sbin/mkfs.<strong>fstype</strong> on the docker host to create the filesystem, and if not found it will return a list of filesystems for which it has found a corresponding mkfs. The specified filesystem must be supported by the running kernel and support labels (-L flag for mkfs). Defaults to ext4 if not specified. </p>
<h3 id="clone-from-vsphere-only">clone-from (vSphere only)<a class="headerlink" href="#clone-from-vsphere-only" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=vsphere --name=CloneVolume -o clone-from=MyVolume -o access=read-only
docker volume create --driver=vsphere --name=CloneVolume -o clone-from=MyVolume -o diskformat=thin (default)
</code></pre>

<p>Specifies a volume to be cloned when creating a new volume. The created clone is completely independent from the original volume and will inherit the same options, which can be changed with the exception of the size and fstype.</p>
<h3 id="flavor-photon-only">flavor (Photon only)<a class="headerlink" href="#flavor-photon-only" title="Permanent link">&para;</a></h3>
<pre><code>docker volume create --driver=vsphere --name=CloneVolume -o flavor=&lt;Photon persistent disk flavor name&gt;
</code></pre>

<p>The flavor specifies the name of the persistent disk flavor that must have already been created in the Photon Controller. The flavor indicats the resource limits that are applied to the volume being created.</p>
<h2 id="docker-volume-list">Docker volume list<a class="headerlink" href="#docker-volume-list" title="Permanent link">&para;</a></h2>
<pre><code>docker volume ls
DRIVER              VOLUME NAME
vsphere                MyVolume@vsanDatastore
vsphere                minio1@vsanDatastore
vsphere                minio2@vsanDatastore
vsphere                redis-data@vsanDatastore
</code></pre>

<h2 id="docker-volume-inspect">Docker volume inspect<a class="headerlink" href="#docker-volume-inspect" title="Permanent link">&para;</a></h2>
<p>You can use <code>docker volume inspect</code> command to see vSphere attributes of a particular volume.</p>
<pre><code>docker volume create —driver=vmdk —name=MyVolume -o size=2gb -o vsan-policy-name=myPolicy -o fstype=xfs
</code></pre>

<pre><code>docker volume inspect MyVolume
[
    {
        &quot;Driver&quot;: &quot;vmdk&quot;,
        &quot;Labels&quot;: {},
        &quot;Mountpoint&quot;: &quot;/mnt/vmdk/MyVolume&quot;,
        &quot;Name&quot;: &quot;MyVolume&quot;,
        &quot;Options&quot;: {
            &quot;fstype&quot;: &quot;xfs&quot;,
            &quot;size&quot;: &quot;2gb&quot;,
            &quot;vsan-policy-name&quot;: &quot;myPolicy&quot;
        },
        &quot;Scope&quot;: &quot;global&quot;,
        &quot;Status&quot;: {
            &quot;access&quot;: &quot;read-write&quot;,
            &quot;attach-as&quot;: &quot;independent_persistent&quot;,
            &quot;capacity&quot;: {
                &quot;allocated&quot;: &quot;32MB&quot;,
                &quot;size&quot;: &quot;2GB&quot;
            },
            &quot;clone-from&quot;: &quot;None&quot;,
            &quot;created&quot;: &quot;Wed Mar  1 20:06:02 2017&quot;,
            &quot;created by VM&quot;: &quot;esx1_swarm01&quot;,
            &quot;datastore&quot;: &quot;vsanDatastore&quot;,
            &quot;diskformat&quot;: &quot;thin&quot;,
            &quot;fstype&quot;: &quot;xfs&quot;,
            &quot;status&quot;: &quot;detached&quot;,
            &quot;vsan-policy-name&quot;: &quot;myPolicy&quot;
        }
    }
]
</code></pre>

<h2 id="docker-compose">Docker Compose<a class="headerlink" href="#docker-compose" title="Permanent link">&para;</a></h2>
<pre><code>cat nginx-stack-vsphere.yaml 
version: &quot;3&quot;
services:
  nginx:
    image: nginx
    ports:
      - &quot;5000:80&quot;
    volumes:
      - log:/var/log/nginx
    deploy:
      replicas: 1 
      restart_policy:
        condition: on-failure

volumes:
   log:
      driver: vsphere
</code></pre>

<pre><code>docker stack deploy -c  nginx-stack-vsphere.yaml nginx
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../datastores/" class="btn btn-neutral float-right" title="Multiple Datastores">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../docker-plugin-drivers/" class="btn btn-neutral" title="Advanced Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../docker-plugin-drivers/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../datastores/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
