<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title> | vSphere Docker Volume Service</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/infracloudio-lavish-bootstrap.css">
<link rel="stylesheet" href="css/vmware-customstyles.css">
<link rel="stylesheet" href="css/infracloudio-theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://idratherbewriting.comfeed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> vSphere Docker Volume Service</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="index.html">Home</a></li>
                
                
                
                <li><a href="faq.html">FAQs</a></li>
                
                
                
                <li><a href="contactus.html">Contact Us</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Downloads<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://store.docker.com/plugins/vsphere-docker-volume-service" target="_blank">Docker Plugin</a></li>
                        
                        
                        
                        <li><a href="https://bintray.com/vmware/vDVS/VIB/_latestVersion" target="_blank">VIB</a></li>
                        
                        
                        
                        <li><a href="https://bintray.com/vmware/vDVS/vDVS_RPM/_latestVersion" target="_blank">RPM</a></li>
                        
                        
                        
                        <li><a href="https://bintray.com/vmware/vDVS/vDVS_DEB/_latestVersion" target="_blank">DEB</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          












<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Menu </li>
    
    
    
    <li>
        <a href="#">Get Started</a>
        <ul>
            
            
            
            <li><a href="index.html">Introduction</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Setup</a>
        <ul>
            
            
            
            <li><a href="prerequisite.html">Prerequsites</a></li>
            
            
            
            
            
            
            <li><a href="install.html">Installation</a></li>
            
            
            
            
            
            
            <li><a href="configuration.html">Configuration</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">User Guide</a>
        <ul>
            
            
            
            <li><a href="docker-volume-cli.html">Docker Volume Management</a></li>
            
            
            
            
            
            
            <li><a href="docker-compatibility.html">Docker Compatibility</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Admin Guide</a>
        <ul>
            
            
            
            <li><a href="datastores.html">Datastores Support</a></li>
            
            
            
            
            
            
            <li><a href="admin-cli.html">Admin CLI Reference</a></li>
            
            
            
            
            
            
            <li><a href="tenancy.html">Multi-tenancy Support</a></li>
            
            
            
            
            
            
            <li><a href="policy-based-management.html">Storage Policy Based Management</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Applications & Examples</a>
        <ul>
            
            
            
            <li><a href="demo-wordpress-app.html">Wordpress application with MariaDB</a></li>
            
            
            
            
            
            
            <li><a href="demo-ha-swarm.html">HA DB in Docker Swarm mode</a></li>
            
            
            
            
            
            
            <li><a href="docker-service.html">Running MongoDB (Docker Service) with vSphere volume</a></li>
            
            
            
            
            
            
            <li><a href="docker-stacks.html">Running an Example App with Docker Stacks</a></li>
            
            
            
            
            
            
            <li><a href="s3-object-storage.html">S3 Object storage with vDVS</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Miscellaneous</a>
        <ul>
            
            
            
            <li><a href="photon.html">Photon Platform</a></li>
            
            
            
            
            
            
            <li><a href="blogs.html">Blogs</a></li>
            
            
            
            
            
            
            <li><a href="known-issues.html">Known Issues</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main"></h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" href="https://github.com/vmware/docker-volume-vsphere/edit/gh-pages/jekyll-docs//docker-volume-auth-proposal.v1_2.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

  <p>Change Log</p>

<table style="width:92%;">
<colgroup>
<col width="15%" />
<col width="13%" />
<col width="12%" />
<col width="52%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Version</p></th>
<th><p>Date</p></th>
<th><p>Who</p></th>
<th><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>1.0</p></td>
<td><p>8/17/16</p></td>
<td><p>Msterin</p></td>
<td><p>Walked over the doc with AndrewStone and added work items at the end</p></td>
</tr>
<tr class="even">
<td><p>1.1</p></td>
<td><p>8/18/16</p></td>
<td><p>AStone</p></td>
<td><p>Conversion to Markdown and DB Usage updates</p></td>
</tr>
<tr class="odd">
<td><p>1.2</p></td>
<td><p>8/29/16</p></td>
<td><p>AStone</p></td>
<td><p>Updates to remove roles altogether and simplify auth data model based on meetings from 8/26/16</p></td>
</tr>
</tbody>
</table>

<h1 id="introduction">Introduction</h1>

<p>Currently the vSphere Docker Volume Service allows any container on any VM with access to any datastore to create, mount, and delete volumes at will. There are no limits to the size of the volumes that can be created or quotas for datastore usage for container volumes. Also, all Docker engines can see and use any volume on any datastore. This lack of access control takes the management of storage out of the hands of the IT administrator and puts it in the hands of the developer. This is a worrying proposition to many IT admins, and since they are the ones that must allow deployment of the service and its associated host agent, we must allow them to regain control with proper enforcement mechanisms that limit damage due to malfeasance or mistake.</p>

<p>In order to further ease the management burden on vSphere administrators, we want to provide them with a way to manage permissions across hosts, datastores, and VMs from a single central location. We also want to maintain existing workflows and embrace existing solutions to both ease development and enhance the comfort of the user. The standard way to centrally manage resources and permissions in the vSphere universe is via vCenter. Our goal then is to provide a solution that enables configuration of access controls via vCenter, while maintaining the flexibility to allow granular enough permissions to satisfy container use cases on vSphere datastores.</p>

<h1 id="background---existing-vsphere-and-docker-permissions">Background - existing (vSphere and Docker) permissions</h1>

<h2 id="vsphere-permissions">vSphere permissions</h2>

<p>VSphere authorization is based around users, groups, roles, objects and permissions. As described in the <a href="https://pubs.vmware.com/vsphere-60/topic/com.vmware.ICbase/PDF/vsphere-esxi-vcenter-server-60-security-guide.pdf">vSphere Security Guide</a> chapter 4:</p>

<blockquote>
  <p>The permission model for vCenter Server systems relies on assigning permissions to objects in the object hierarchy of that vCenter Server. Each permission gives one user or group a set of privileges, that is, a role, for a selected object. For example, you can select an ESXi host and assign a role to a group of users to give those users the corresponding privileges on that host.</p>
</blockquote>

<p>These privileges are predefined, but new ones can be defined <strong>via vCenter extensions (solutions).</strong> All predefined privileges are listed in Chapter 10 of the vSphere Security Guide. While there are permissions on datastores defined, they are not granular or flexible enough to satisfy our needs for access control involving container workflows. In order to satisfy our requirements we must do one of the following:</p>

<ol>
  <li>Add a Datastore.Volume object level to allow more granular permissions, such as limiting the size of new volumes or making them visible only to certain users, by editing the Authz/VC code</li>
  <li>Build a vCenter extension that does the same as 1</li>
  <li>Forego vCenter permissions altogether and implement an alternative authorization solution</li>
</ol>

<h2 id="docker-users-and-permissions">Docker users and permissions</h2>

<p>The Docker engine is usable from any user account with privileges to run Docker commands. Docker <em>requires root privileges</em> to run Docker commands, which can be enabled by adding users to the ‘docker’ group. Therefore there are no restrictions on Docker usage between users of Docker.</p>

<p>Furthermore, the Docker volume plugin API does not pass any user information from Docker to volume drivers. The sources of Docker volume requests from the guest are indistinguishable from one another. Additionally, the Docker client may be on a separate physical machine from the Docker server, and therefore the Docker server machine may not even know which user is running Docker commands. This means that guest user based access control for vSphere Docker Volume Service permissions is infeasible without significant changes to Docker core code, specifically Plugin API and remote access control code.</p>

<h1 id="required-permissions-and-caveats">Required permissions and caveats</h1>

<p>From internal discussions and discussion with customers, it has become apparent that a certain base level of access control is required for production usage of a Docker volume plugin. Volume size, datastore placement, visibility, and operations such as create, mount, and delete must be limited to certain users or groups of users. However, due to the fact that Docker does not provide for user disambiguation we must come up with a way to authorize and grant privileges in some other manner.</p>

<p>We have chosen to authorize access and grant privileges based on the guest VM running the command. Every request that comes from the plugin and ends up on the host agent is associated with a VM running on that host. This is <a href="http://pubs.vmware.com/vsphere-60/topic/com.vmware.ICbase/PDF/ws9_esx60_vmci_sockets.pdf">unforgeable</a> and allows for access control using VM as the identity. We can associate privileges with each VM or group of VMs and provide responses from the host agent to the volume driver based on those privileges. This allows the full range of required permissions to be satisfied.</p>

<p>Note that since vSphere authorization is based around users, and Docker volume driver authorization is based around VM identities, we are already outside the realm of what’s possible using standard methods. While we could add privileges at finer levels and add a whole new hierarchy of permissions for tenants and visibility of volumes, there is still no built-in vSphere method to enforce those permissions using VM identities. In order to minimize coupling to vSphere release cycles, and reduce implementation complexity, privileges granted to VMs for Docker volume management will be implemented in a different manner to be described in the implementation section.</p>

<h1 id="permissions-model">Permissions Model</h1>

<p>As mentioned above, permissions for Docker volume service usage are granted to VMs or groups of VMs. A group of VMs is known as a <code class="highlighter-rouge">Tenant</code>. Tenants provide for full isolation of volumes such that volumes created by one tenant are neither visible nor usable from other tenants, even if those volumes reside on datastores shared by tenants. An exception to this rule is if the <code class="highlighter-rouge">global</code> <code class="highlighter-rouge">visibility</code> privilege is granted to a tenant for a datastore. This allows the tenant to see all volumes in all tenants on the datastore.</p>

<p>Privileges consist of operations against a datastore and limits on those operations. Privileges are assigned per datastore, and each tenant may have different privileges for different datastores.</p>

<p>To illustrate the above, here is a simple <strong>Use Case</strong>:</p>

<ul>
  <li>There are 2 product teams which need 2 docker environments for each team - Dev and Test.</li>
  <li>They request it from Vsphere Admin.
    <ul>
      <li>The Admin creates 4 tenants (Product1Dec, Product1Test, Product2Dev, Product2Test) and sets storage quotas</li>
      <li>The admin then create a bunch (say 16 :-) VMs and assigns them to specific Tenants.</li>
    </ul>
  </li>
  <li>The admin gives teams dedicated endpoints (VMs IPs)</li>
  <li>Teams now manage user accounts themselves, but the VMs have only access to storage allocated to them
    <ul>
      <li>Also, Docker volumes are now setting in separate namespaces, so “volume1” for Product1Test is a different volume from “volume1” for Product2Test</li>
    </ul>
  </li>
</ul>

<h3 id="privileges-and-limits">Privileges and limits</h3>

<p>The following privileges and limits can be granted to tenants for specific datastores.</p>

<ul>
  <li>[ this one is postponed] <em>Privilege</em>: Global Visibility – Tenant can see all volumes created by all tenants</li>
  <li><em>Privilege</em>: Create volumes
    <ul>
      <li><em>Limit</em>: Maximum Size of a volume, in MB</li>
      <li><em>Limit</em>: Maximum storage provisioned on a datastore to all volumes for the tenant, in MB.</li>
    </ul>
  </li>
  <li><em>Privilege</em>: Remove a volume</li>
  <li><em>Privilege</em>: Mount a volume</li>
</ul>

<h4 id="example">Example</h4>

<p>The following example is illustrated via CLI commands from a hypothetical program called <code class="highlighter-rouge">auth_config</code>. <code class="highlighter-rouge">auth_config</code> is not tied to any specific implementation but is expected to display the workflow of managing authorization configuration.</p>

<ol>
  <li>
    <p><strong>Create a tenant named <code class="highlighter-rouge">tenant1</code> consisting of 3 VMs</strong>
<code class="highlighter-rouge">auth_config</code> <code class="highlighter-rouge">tenant</code> <code class="highlighter-rouge">create</code> <code class="highlighter-rouge">tenant1</code> <code class="highlighter-rouge">--vms</code> <code class="highlighter-rouge">vm1,vm2,vm3</code></p>
  </li>
  <li>
    <p><strong>Assigning create, mount and delete privileges to a datastore for a tenant</strong>
<code class="highlighter-rouge">auth_config</code> <code class="highlighter-rouge">tenant</code> <code class="highlighter-rouge">set</code> <code class="highlighter-rouge">privileges</code> <code class="highlighter-rouge">--tenant</code> <code class="highlighter-rouge">tenant1</code> <code class="highlighter-rouge">--datastore</code> <code class="highlighter-rouge">datastore1</code> <code class="highlighter-rouge">--privileges</code> <code class="highlighter-rouge">create,mount,delete</code></p>
  </li>
  <li>
    <p><strong>Commit the configuration</strong></p>
  </li>
</ol>

<p><code class="highlighter-rouge">auth_config</code> <code class="highlighter-rouge">commit</code></p>

<p>&lt;/ol&gt;
### Defaults</p>

<p>By default, VMs are assigned to a default tenant and are granted unlimited privileges to all datastores visible from the host on which they reside. The privileges on the default tenant cannot be modified or restricted. VMs can see all volumes ever created on these datastores by other VMs that are or were part of the default tenant, and can mount and delete these volumes. However, volumes created by VMs on a tenant other than the default tenant are not visible to VMs in the default tenant. Note that a VM can only be a member of a single tenant at a time.</p>

<p>The goal of open defaults on the default tenant is to allow evaluation usage of the Docker volume driver without the user having to worry about configuration. However, in a production scenario, <em>all VMs</em> should be assigned to non-default tenants. Even though volumes in other tenants are not visible to VMs in the default tenant, and thus inaccessible to them, VMs in the default tenant can fill production datastores and make creation of volumes from other tenants impossible.</p>

<h1 id="implementation">Implementation</h1>

<p>Since authorization is based on VM identity and visibility of volumes is tied to tenants, a new strategy outside the standard vSphere authorization model is required. While the privileges and identities used for authorization differ from the vSphere model, it is still desirable to have them managed from within vCenter, as this is the standard place for centralized configuration in all current vSphere deployments. Both of the preceding statements lead to the following implementation design:</p>

<ul>
  <li>A vCenter plugin will be created to allow centralized management of tenants, privileges, datastores and VMs for the Docker volume plugin.</li>
  <li>A new host based authorization mechanism will enable access control at a tenant level.</li>
  <li>New VMODL interface definitions for defining tenants, roles and privileges for the Docker volume plugin will be created.</li>
  <li>All configuration for host based authorization will be via VMOMI using the new VMODL definitions.</li>
  <li>VMOMI SOAP endpoints on ESXi hosts for the authorization definitions will update per-datastore SQLite databases on configuration changes.</li>
</ul>

<h1 id="vcenter-plugin">VCenter plugin</h1>

<p>In order to provide a user interface enabling centralized configuration without changing the core vCenter code, a vCenter plugin will be implemented. As our team is not flush with UI experts, the layout described here will be a rough overview consisting of the necessary behaviors and operations. The specific layout and views will likely be different in the actual implementation.</p>

<h3 id="overall-layout">Overall layout</h3>

<p>The overall suggested layout of the plugin is that of a single page web-app. This page will exist as a tab in vCenter. All operations required for managing roles and permissions of the Docker volume plugin within a datacenter will be provided in this tab.</p>

<h3 id="vms-as-docker-hosts">VMs as Docker hosts</h3>

<p>It should be possible to show all VMs in the datacenter in the plugin. There should be some mechanism (checkboxes, drag and drop etc..) to enable that VM as a Docker host. Once a VM is enabled as a Docker host it is capable of being assigned to a tenant.</p>

<h3 id="tenants-vms-datastores">Tenants, VMs, Datastores</h3>

<p>All Docker host VMs are assigned to tenants. A Docker host VM is a member of exactly one tenant. Tenants should be created in a dialog box or other UI element. This dialog should allow applying privileges to datastores for the given tenant. Privileges can be changed at any time after creation.</p>

<p>All updates to a running configuration should be changed via a big fat red COMMIT button.</p>

<h3 id="web-server">Web Server</h3>

<p>Since we are extending VMODL, all configuration requests from the web client will go through VPXD. This obviates the need for a specific webserver running on the VCenter host.</p>

<h3 id="authorization-databases">Authorization Databases</h3>

<p>In order to perform authorization, the <code class="highlighter-rouge">vmdk_ops</code> agent on each ESX host must be able to verify access rights for Docker volumes for a requesting VM. Each datastore maintains a SQLite database that manages all access control information to facilitate this authorization. These databases get populated from VMODL update handlers running on ESX hosts.</p>

<p><code class="highlighter-rouge">vmdk_ops</code> maintains a persistant connection to the SQLite database on each Datastore it has access to. On each Docker operation against a datastore, the <code class="highlighter-rouge">vmdk_ops</code> agent will check the requesting VM’s permissions for this operation on the datastore in question. It does this by first checking which tenant the VM belongs to, and then checking the tenants’ rights on that datastore.</p>

<h3 id="database-schema">Database Schema</h3>

<p>Databases are per-datastore. There are 3 tables provided in the authorization database: tenants, vms, and privileges. Their schemas are provided below using SQLite syntax. To enhance query speed, indexes and views can be created as necessary.</p>

<h3 id="tenants-schema">Tenants Schema</h3>

<p>Each tenant has an immutable id, a name, and a description.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tenants</span><span class="p">(</span>
  <span class="n">id</span> <span class="n">TEXT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">name</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="n">description</span> <span class="n">TEXT</span><span class="p">,</span>
<span class="p">);</span>
</code></pre>
</div>

<h3 id="vms-schema">VMs Schema</h3>

<p>Each VM maps to a single tenant.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">vms</span><span class="p">(</span>
  <span class="n">vm_id</span> <span class="n">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">vm_name</span> <span class="n">TEXT</span><span class="p">,</span>
  <span class="n">tenant_id</span> <span class="n">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">tenant_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tenants</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre>
</div>

<h3 id="privileges-schema">Privileges Schema</h3>

<p>Privileges are unique to a (tenant, datastore) pair.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">privileges</span> <span class="p">(</span>
  <span class="n">tenant_id</span> <span class="n">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">datastore</span> <span class="n">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">create</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="k">delete</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="n">mount</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="n">max_volume_size</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="n">max_usage</span> <span class="n">INTEGER</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">tenant_id</span><span class="p">,</span> <span class="n">datastore</span><span class="p">),</span>
  <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">tenant_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tenants</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre>
</div>

<h1 id="volume-storage">Volume Storage</h1>

<p>Each tenant will have it’s own directory under /vmfs/volumes/<DATASTORE>/dockvols. All volumes created by that tenant will live in the tenant’s directory. Tenants without global visibility permissions are only allowed to list volumes in that directory. Tenants with global visibility permissions can list all volumes in all tenant directories. Due to the fact that volumes in different tenants can have the same names, the tenant name must be prepended to the volume name when access is requested outside the tenant. For example, if tenant `A` wants to create a volume named `NewVolume` in tenant `B` on `datastore1`, the Docker volume command would be `docker` `volume` `create` `B/NewVolume@datastore1`. However, if tenant `A` only wanted to create that volume on it’s own tenant, it could just do `docker` `volume` `create` `NewVolume@datastore1`. If `datastore1` was the default datastore for the VM then it could be excluded from the command as well, like: `docker` `volume` `create` `NewVolume`.</DATASTORE></p>

<p>Volumes listed from tenants with global visibility would appear like this, where <code class="highlighter-rouge">A</code> and <code class="highlighter-rouge">B</code> are tenant names:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>A/Vol1@datastore1
B/Vol1@datastore1
B/Vol1@datastore2
</code></pre>
</div>

<p>Volumes listed from tenants without global visibility would not show the tenant name:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Vol1@datastore1
Vol2@datastore1
Vol1@datastore2
</code></pre>
</div>

<p>NOTE: global visibility support is postponed (9/26/2016)</p>


  

    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 VMWare. All rights reserved. <br />
 Site last generated: Jul 20, 2017 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>