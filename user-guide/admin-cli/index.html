<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="cna-storage@vmware.com">
  
  <title>Admin CLI - Docker Volume Driver for vSphere</title>
  

  <link rel="shortcut icon" href="../../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Admin CLI";
    var mkdocs_page_input_path = "user-guide/admin-cli.md";
    var mkdocs_page_url = "/user-guide/admin-cli/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-81413942-1', 'https://vmware.github.io/docker-volume-vsphere/');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Docker Volume Driver for vSphere</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Features</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/vcenter/">Integration with vCenter</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../features/vsan-policy/">VSAN Policy</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Documentation</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../install/">Installation and Deployment</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Admin CLI</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
                
            
                <li class="toctree-l3"><a href="#ls">ls</a></li>
                
                    <li><a class="toctree-l4" href="#help">Help</a></li>
                
                    <li><a class="toctree-l4" href="#list-all">List All</a></li>
                
                    <li><a class="toctree-l4" href="#list-selected-columns">List selected columns</a></li>
                
            
                <li class="toctree-l3"><a href="#policy">policy</a></li>
                
                    <li><a class="toctree-l4" href="#help_1">Help</a></li>
                
                    <li><a class="toctree-l4" href="#create">Create</a></li>
                
                    <li><a class="toctree-l4" href="#list">List</a></li>
                
                    <li><a class="toctree-l4" href="#update">Update</a></li>
                
                    <li><a class="toctree-l4" href="#remove">Remove</a></li>
                
            
                <li class="toctree-l3"><a href="#status">Status</a></li>
                
            
            </ul>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Docker Volume CLI</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../docker-volume-cli/">Basic commands</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../datastores/">Multiple Datastores</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Backend ESX Overview</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../esx-overview/">Volume Layout</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../faq/">FAQ</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Docker Volume Driver for vSphere</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Documentation &raquo;</li>
        
      
    
    <li>Admin CLI</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#ls">ls</a><ul>
<li><a href="#help">Help</a></li>
<li><a href="#list-all">List All</a></li>
<li><a href="#list-selected-columns">List selected columns</a></li>
</ul>
</li>
<li><a href="#policy">policy</a><ul>
<li><a href="#help_1">Help</a></li>
<li><a href="#create">Create</a></li>
<li><a href="#list">List</a></li>
<li><a href="#update">Update</a></li>
<li><a href="#remove">Remove</a></li>
</ul>
</li>
<li><a href="#status">Status</a></li>
</ul>
</div>
<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<p>In the context of the Docker volume plugin for vSphere, each ESXi host manages multiple VMs, with
each of them acting as a Docker host. The Docker engine on these hosts communicates with the Docker
volume plugin in order to create and delete virtual disks (VMDKs), as well as mount them as Docker
volumes. These virtual disks may live on any datastore accessible to the ESXi host and are managed
by the Docker user via the Docker CLI. However, the Docker CLI is limited in what visibility it can
provide to the user. Furthermore, it is desirable that an administrator be able to get a global view
of all virtual disks created and in use on the host.  For these reasons, an admin CLI has been
created that runs on the ESXi host and that provides access to information not visible from the
Docker CLI. The remainder of this document will describe each admin CLI command and provide examples
of their usage.</p>
<h1 id="ls">ls<a class="headerlink" href="#ls" title="Permanent link">&para;</a></h1>
<h3 id="help">Help<a class="headerlink" href="#help" title="Permanent link">&para;</a></h3>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py ls -h
usage: vmdkops_admin.py ls [-h] [-c Col1,Col2,...]

optional arguments:
  -h, --help        show this help message and exit
  -c Col1,Col2,...  Display selected columns: Choices = ['volume',
                    'datastore', 'created-by', 'created', 'attached-to',
                    'policy', 'capacity', 'used']
</code></pre>

<h3 id="list-all">List All<a class="headerlink" href="#list-all" title="Permanent link">&para;</a></h3>
<p>List all properties for all Docker volumes that exist on datastores accessible to the host.</p>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py ls
Volume     Datastore   Created By VM  Created                   Attached To VM  Policy  Capacity  Used
---------  ----------  -------------  ------------------------  --------------  ------  --------  -------
large-vol  datastore1  Ubuntu_15.10   Sat Apr 16 13:34:12 2016  detached        N/A     1.00GB    25.00MB
vol        datastore1  Ubuntu_15.10   Sat Apr 16 20:13:18 2016  detached        N/A     100.00MB  14.00MB
</code></pre>

<p>Note that the <code>Policy</code> column shows the named VSAN storage policy created with the same tool
(vmdkops_admin.py).  Since these example virtual disks live on a VMFS datastore they do not have a storage
policy and show up as `N/A&rsquo;.</p>
<h3 id="list-selected-columns">List selected columns<a class="headerlink" href="#list-selected-columns" title="Permanent link">&para;</a></h3>
<p>Show only the selected columns.</p>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py ls -c volume,datastore,attached-to
Volume     Datastore   Attached To VM
---------  ----------  --------------
large-vol  datastore1  detached
vol        datastore1  detached
</code></pre>

<p>Note that the that the choices are given in a comma separated list with no spaces, and are shown in
the help given above with <code>vmdkops_admin ls -h</code>.</p>
<h1 id="policy">policy<a class="headerlink" href="#policy" title="Permanent link">&para;</a></h1>
<p>Create, configure and show the VSAN policy names and their corresponding VSAN policy strings. Also show whether or not they are in use.</p>
<h3 id="help_1">Help<a class="headerlink" href="#help_1" title="Permanent link">&para;</a></h3>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py policy -h
usage: vmdkops_admin.py policy [-h] {rm,create,ls,update} ...

positional arguments:
  {rm,create,ls,update}
    rm                  Remove a storage policy
    create              Create a storage policy
    ls                  List storage policies and volumes using those policies
    update              Update the definition of a storage policy and all VSAN
                        objects using that policy

optional arguments:
  -h, --help            show this help message and exit
</code></pre>

<h3 id="create">Create<a class="headerlink" href="#create" title="Permanent link">&para;</a></h3>
<p>Create a VSAN storage policy.</p>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py policy create --name some-policy --content '((&quot;proportionalCapacity&quot; i0)(&quot;hostFailuresToTolerate&quot; i0)'
Successfully created policy: some-policy
</code></pre>

<p>Note that the VSAN storage policy string given with <code>--content</code> is a standard VSAN storage policy
string.  Please refer to the <a href="https://pubs.vmware.com/vsphere-60/index.jsp?topic=%2Fcom.vmware.vcli.ref.doc%2Fesxcli_vsan.html">VSAN documentation</a>
for storage policy options.</p>
<h3 id="list">List<a class="headerlink" href="#list" title="Permanent link">&para;</a></h3>
<p>List all VSAN storage policies.</p>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py policy ls
Policy Name  Policy Content                                             Active
-----------  ---------------------------------------------------------  ------
some-policy  ((&quot;proportionalCapacity&quot; i0)(&quot;hostFailuresToTolerate&quot; i0)  Unused
</code></pre>

<p>When creating a virtual disk using <code>docker volume create</code>, the policy name should be given with the <code>-o</code>
option such as <code>docker volume create --driver=vmdk --name=some-vol -o vsan-policy-name=some-policy</code>.
The number of virtual disks using the policy will then show up in the <code>Active</code> column.</p>
<h3 id="update">Update<a class="headerlink" href="#update" title="Permanent link">&para;</a></h3>
<p>Update a VSAN storage policy.</p>
<p>This command will update a VSAN storage policy for all virtual disks currently using this policy. If
the command fails, the number of virtual disks that were successfully updated and the number that
failed to update will be shown. The names of the virtual disks that failed to update will be logged
so that manual action can be taken.</p>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py policy update --name some-policy --content '((&quot;proportionalCapacity&quot; i1)'
This operation may take a while. Please be patient.
Successfully updated policy: some-policy
</code></pre>

<h3 id="remove">Remove<a class="headerlink" href="#remove" title="Permanent link">&para;</a></h3>
<p>Remove a VSAN storage policy. Note that a storage policy cannot be removed if it is currently in use
by one or more virtual disks.</p>
<p>The ability to list which virtual disks are using a specific storage policy, change storage policies
for a virtual disk, and reset virtual disks to the default storage policy is a necessary
enhancement tracked <a href="https://github.com/vmware/docker-volume-vsphere/issues/577">here</a>.</p>
<pre><code>[root@localhost:~] /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py policy rm some-policy
Successfully removed policy: some-policy
</code></pre>

<h1 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h1>
<p>Show config and run-time information about the service.</p>
<pre><code>[root@localhost:~]  /usr/lib/vmware/vmdkops/bin/vmdkops_admin.py status
 Version: 1.0.0-0.0.1
 Status: Running
 Pid: 161104
 Port: 1019
 LogConfigFile: /etc/vmware/vmdkops/log_config.json
 LogFile: /var/log/vmware/vmdk_ops.log
 LogLevel: INFO
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../docker-volume-cli/" class="btn btn-neutral float-right" title="Basic commands">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../install/" class="btn btn-neutral" title="Installation and Deployment"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../install/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../docker-volume-cli/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
